<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Auto AI Photo Enhancer</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.12.0/dist/tf.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/body-pix"></script>
<script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/deeplab"></script>
<style>
body{margin:0;font-family:sans-serif;text-align:center;background:#222;color:white;}
input{margin:15px;}
canvas{margin-top:20px;border-radius:12px;max-width:95%;}
button{padding:10px 20px;margin:10px;background:#00c3ff;border:none;border-radius:8px;color:#000;font-weight:bold;cursor:pointer;}
</style>
</head>
<body>

<h2>ü§ñ Auto AI Photo Enhancer</h2>
<input type="file" id="upload" accept="image/*"><br>
<button onclick="enhance()">‚ú® Auto Enhance</button>
<button onclick="download()">‚¨á Download</button>
<br>
<canvas id="canvas"></canvas>

<script>

let img = new Image();
let canvas = document.getElementById("canvas");
let ctx = canvas.getContext("2d");

document.getElementById("upload").addEventListener("change", e=>{
    let reader = new FileReader();
    reader.onload = event=>{
        img.onload=()=>{
            canvas.width = img.width;
            canvas.height = img.height;
            ctx.drawImage(img,0,0);
        }
        img.src = event.target.result;
    }
    reader.readAsDataURL(e.target.files[0]);
});

async function enhance(){
    if(!img.src) return alert("Upload a photo first");

    // Draw original
    ctx.drawImage(img,0,0);

    // 1Ô∏è‚É£ Face & body segmentation for background
    const net = await bodyPix.load();
    const segmentation = await net.segmentPerson(canvas,{internalResolution:'medium'});
    
    // 2Ô∏è‚É£ Background whitening
    const imageData = ctx.getImageData(0,0,canvas.width,canvas.height);
    for(let i=0;i<imageData.data.length;i+=4){
        let n = i/4;
        if(segmentation.data[n]===0){
            imageData.data[i]=255;
            imageData.data[i+1]=255;
            imageData.data[i+2]=255;
        }
    }
    ctx.putImageData(imageData,0,0);

    // 3Ô∏è‚É£ Apply simple auto enhancement (contrast, brightness, sharpness)
    let data = ctx.getImageData(0,0,canvas.width,canvas.height);
    for(let i=0;i<data.data.length;i+=4){
        // Auto brightness/contrast
        for(let j=0;j<3;j++){
            data.data[i+j]=Math.min(255,Math.max(0, (data.data[i+j]-128)*1.2 + 128)); 
        }
        // Boost black points
        for(let j=0;j<3;j++){
            if(data.data[i+j]<50) data.data[i+j]=0;
        }
    }
    ctx.putImageData(data,0,0);

    // 4Ô∏è‚É£ Optional sharpen (light)
    sharpenCanvas(1.2);

    alert("‚úÖ Photo enhanced automatically!");
}

function sharpenCanvas(strength){
    const weights = [
        0,-1*strength,0,
        -1*strength,5*strength,-1*strength,
        0,-1*strength,0
    ];
    const side = Math.round(Math.sqrt(weights.length));
    const halfSide = Math.floor(side/2);

    const src = ctx.getImageData(0,0,canvas.width,canvas.height);
    const sw = src.width;
    const sh = src.height;
    const srcData = src.data;

    const output = ctx.createImageData(sw,sh);
    const dst = output.data;

    for(let y=0;y<sh;y++){
        for(let x=0;x<sw;x++){
            let dstOff = (y*sw+x)*4;
            let r=0,g=0,b=0;
            for(let cy=0;cy<side;cy++){
                for(let cx=0;cx<side;cx++){
                    let scy = Math.min(sh-1,Math.max(0,y+cy-halfSide));
                    let scx = Math.min(sw-1,Math.max(0,x+cx-halfSide));
                    let srcOff = (scy*sw+scx)*4;
                    let wt = weights[cy*side+cx];
                    r+=srcData[srcOff]*wt;
                    g+=srcData[srcOff+1]*wt;
                    b+=srcData[srcOff+2]*wt;
                }
            }
            dst[dstOff]=r; dst[dstOff+1]=g; dst[dstOff+2]=b; dst[dstOff+3]=255;
        }
    }
    ctx.putImageData(output,0,0);
}

function download(){
    const link = document.createElement("a");
    link.download = "enhanced.png";
    link.href = canvas.toDataURL("image/png",1.0);
    link.click();
}

</script>

</body>
</html>
